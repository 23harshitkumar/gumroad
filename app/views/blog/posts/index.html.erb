<div class="blog-scope">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <header class="mb-12">
      <h1 class="text-6xl font-bold text-black">Blog</h1>
    </header>

    <%# Category Filters - Styled as Tab Pills %>
    <nav class="mb-12" role="tablist">
      <ul class="flex flex-wrap gap-x-3 gap-y-3">
        <li>
          <%# All Posts Pill %>
          <% all_posts_active = params[:category_name].blank? && params[:tag_name].blank? %>
          <%= link_to "All Posts", blog_index_path,
              role: "tab",
              aria_selected: all_posts_active,
              class: "block px-5 py-2.5 rounded-md text-md font-medium border border-black transition-all duration-150 ease-in-out
                      #{ all_posts_active ?
                          'bg-black text-white shadow-[3px_3px_0_0_rgba(0,0,0,0.2)]' :
                          'bg-white text-black hover:bg-gray-50 hover:-translate-x-px hover:-translate-y-px hover:shadow-[2px_2px_0_0_#000]' }" %>
        </li>
        <%# Static categories from mockup - these now link to category filter URLs %>
        <% ["Creators", "Tips & tricks", "Product updates", "Community"].each do |static_category_name| %>
          <% parameterized_category = static_category_name.parameterize %>
          <% is_active_static = params[:category_name] == parameterized_category %>
          <li>
            <%= link_to static_category_name, blog_index_path(category_name: parameterized_category),
                role: "tab",
                aria_selected: is_active_static,
                class: "block px-5 py-2.5 rounded-md text-md font-medium border border-black transition-all duration-150 ease-in-out
                        #{ is_active_static ?
                            'bg-black text-white shadow-[3px_3px_0_0_rgba(0,0,0,0.2)]' :
                            'bg-white text-black hover:bg-gray-50 hover:-translate-x-px hover:-translate-y-px hover:shadow-[2px_2px_0_0_#000]' }" %>
          </li>
        <% end %>
      </ul>
    </nav>

    <%# Side-by-side Featured Post & Recent Updates %>
    <div class="flex flex-col lg:flex-row lg:gap-8 mb-12 items-start">
      <%# Featured Post Section - Left Side %>
      <section class="lg:w-2/3 mb-8 lg:mb-0">
        <h2 class="text-xl font-semibold mb-3 uppercase tracking-wider text-gray-700">Featured</h2>
        <% if @featured_post %>
          <article>
            <% if @featured_post.featured_image %>
              <%= link_to blog_post_path(slug: @featured_post.slug) do %>
                <%= image_tag @featured_post.featured_image, alt: (@featured_post.title || "Featured image"), class: "w-full h-auto object-cover border-b-2 border-black rounded-lg" %>
              <% end %>
            <% end %>
            <div class="p-6">
              <div class="mb-3">
                <% (@featured_post.tags || []).each_with_index do |tag, index|
                   break if tag.blank? || index >= 4 %>
                  <span class="inline-block rounded-md px-4 py-2 text-sm font-semibold mr-2 mb-2 #{index == 0 ? 'bg-black text-white' : 'bg-white text-black border border-black'}">
                    <%= tag.titleize %>
                  </span>
                <% end %>
              </div>
              <h3 class="text-3xl lg:text-4xl font-bold mb-2 leading-tight">
                <%= link_to (@featured_post.title || "Untitled Post"), blog_post_path(slug: @featured_post.slug), class: "text-black hover:text-pink-600" %>
              </h3>
              <p class="text-md text-gray-600"><%= @featured_post.date&.strftime("%B %d, %Y") || "Date N/A" %></p>
            </div>
          </article>
        <% else %>
          <p class="text-gray-600 p-8 border-2 border-dashed border-gray-300 rounded-lg text-center min-h-[300px] flex items-center justify-center">No featured post available.</p>
        <% end %>
      </section>

      <%# Recent Updates Section - Right Side - Sticky Sidebar %>
      <aside class="lg:w-1/3 lg:sticky lg:top-24">
        <div class="p-6 border border-gray-300 rounded-lg h-full bg-white shadow-sm flex flex-col" style="max-height: calc(100vh - 10rem);">
          <h3 class="text-xl font-semibold mb-6 border-b border-gray-300 pb-3 flex-shrink-0">Recent updates</h3>
          <% if @recent_updates.any? %>
            <ul class="space-y-5 overflow-y-auto flex-grow">
              <% @recent_updates.each do |post| %>
                <li class="pb-5 border-b border-gray-200 last:border-b-0 last:pb-0 flex justify-between items-start">
                  <div>
                    <h4 class="font-medium text-lg mb-1 hover:text-pink-600">
                      <%= link_to (post.title.presence || "Untitled Post"), blog_post_path(slug: post.slug) %>
                    </h4>
                    <p class="text-sm text-gray-500"><%= post.date&.strftime("%B %d, %Y") || "Date N/A" %></p>
                  </div>
                  <%= link_to "→", blog_post_path(slug: post.slug), class: "flex-shrink-0 ml-4 text-xl text-black hover:text-pink-600 font-semibold p-2 border border-black rounded-full w-10 h-10 flex items-center justify-center" %>
                </li>
              <% end %>
            </ul>
            <div class="mt-6 flex-shrink-0">
              <%= link_to "See all →", blog_index_path, class: "inline-block text-black hover:text-pink-600 font-semibold" %>
            </div>
          <% else %>
            <p class="text-gray-500">No recent updates.</p>
          <% end %>
        </div>
      </aside>
    </div>

    <%# Main Post Grid - Spans full width %>
    <section class="mt-12 pt-12">
      <div class="grid override grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <% displayed_slugs = [@featured_post&.slug].compact %>
        <% posts_for_grid = (@posts + @recent_updates).uniq(&:slug).reject { |p| displayed_slugs.include?(p.slug) }.first(9) %>
        <% posts_for_grid.each do |post| %>
          <% displayed_slugs << post.slug %>
          <article class="border-2 border-black rounded-lg overflow-hidden bg-white shadow-lg flex flex-col">
            <% if post.featured_image %>
              <%= link_to blog_post_path(slug: post.slug) do %>
                <%= image_tag post.featured_image, alt: (post.title.presence || "Blog post image"), class: "w-full h-48 object-cover border-b-2 border-black" %>
              <% end %>
            <% end %>
            <div class="p-6 flex flex-col flex-grow">
              <div class="mb-3">
                <% (post.tags || []).each_with_index do |tag, index|
                    break if tag.blank? || index >= 3 %>
                  <span class="inline-block rounded-md px-3 py-1 text-xs font-semibold mr-1 mb-1 #{index == 0 ? 'bg-black text-white' : 'bg-white text-black border border-black'}">
                    <%= tag.titleize %>
                  </span>
                <% end %>
              </div>
              <h3 class="text-xl font-bold mb-2 leading-tight flex-grow">
                <%= link_to (post.title.presence || "Untitled Post"), blog_post_path(slug: post.slug), class: "text-black hover:text-pink-600" %>
              </h3>
              <p class="text-sm text-gray-600 mt-auto pt-2"><%= post.date&.strftime("%B %d, %Y") || "Date N/A" %></p>
            </div>
          </article>
        <% end %>
        <% if posts_for_grid.empty? && !@featured_post %>
          <p class="text-gray-600 col-span-full text-center py-10">No posts found (after featured and recent).</p>
        <% end %>
      </div>
    </section>
  </div>
</div> <%# Closes .container %>

<%= render "home/shared/footer" %>
