<div class="blog-scope">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
    <article class="max-w-3xl mx-auto">
      <header class="mb-8 md:mb-12">
        <div class="flex flex-wrap items-baseline gap-x-4 mb-3">
          <% combined_tags_and_category = [] %>
          <% combined_tags_and_category << @post.category if @post.category.present? %>
          <% combined_tags_and_category.concat(@post.tags || []) %>

          <% if combined_tags_and_category.any? %>
            <div class="flex flex-wrap justify-start">
              <% combined_tags_and_category.each_with_index do |tag_or_category_name, index|
                 next if tag_or_category_name.blank? %>
                <%= render 'blog/shared/tag', tag_name: tag_or_category_name, is_primary: (index == 0) %>
              <% end %>
            </div>
          <% end %>
        </div>

        <h1 class="text-3xl sm:text-4xl lg:text-5xl text-gray-900 mb-5 leading-tight">
          <%= @post.title || "Untitled Post" %>
        </h1>

        <p class="text-gray-500 text-lg">
          <%= format_blog_date(@post.date) %>
        </p>
      </header>

      <% if @post.featured_image %>
        <div class="mb-8 md:mb-12 border border-black rounded-lg overflow-hidden">
          <%= image_tag @post.featured_image, alt: (@post.title || "Featured image"), class: "w-full h-auto object-cover" %>
        </div>
      <% end %>

      <div class="prose prose-lg lg:prose-xl max-w-none text-gray-800">
        <% content_partial_path = "blog/posts/#{params[:slug]}" %>
        <% if lookup_context.template_exists?(content_partial_path, [], true) %>
          <%= render partial: content_partial_path %>
        <% else %>
          <% if Rails.env.development? || Rails.env.test? %>
            <p class="text-red-500">
              Error: Content for this post could not be found. Expected partial:
              <%= content_partial_path %>
            </p>
            <p>
              Please ensure a file named an underscore followed by the slug
              <code>.html.erb</code> (e.g.,
              <code>_my-first-post.html.erb</code>) exists in
              <code>app/views/blog/posts/</code>.
            </p>
          <% else %>
            <p class="text-red-500">
              Sorry, this post is currently unavailable.
            </p>
          <% end %>
        <% end %>
      </div>

      <%# TODO: Add navigation to next/previous posts if desired %>
      <%# TODO: Add social sharing buttons %>
      <%# TODO: Add comments section if planned %>

      <div class="mt-12 md:mt-16 pt-8 border-t border-gray-200">
        <%= link_to "← Back to Blog", blog_index_path, class: "text-pink-600 hover:text-pink-800 text-lg" %>
      </div>
    </article>
  </div>
</div>

<%= render "home/shared/footer" %>
