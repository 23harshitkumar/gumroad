<%# app/views/blog/posts/show.html.erb %>
<%# This view now acts as a wrapper and renders a content partial based on the slug %>

<%# @post is set by the controller from the blog_manifest.yml for metadata %>
<%# The actual post content is in a partial like _my-first-post-content.html.erb %>

<div class="blog-scope">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <article class="max-w-3xl mx-auto">
      <header class="mb-8 text-center">
        <% if @post.category.present? %>
          <p class="text-pink-600 font-semibold uppercase tracking-wider mb-2"><%= @post.category %></p>
        <% end %>
        <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-3"><%= @post.title || "Untitled Post" %></h1>
        <p class="text-gray-500 text-sm">
          Published on <%= @post.date ? @post.date.strftime("%B %d, %Y") : "Date N/A" %>
        </p>
        <% if @post.tags&.any? %>
          <div class="mt-4 flex flex-wrap justify-center gap-2">
            <% @post.tags.each do |tag|
               next if tag.blank? %>
              <span class="inline-block bg-gray-100 rounded-full px-3 py-1 text-xs font-semibold text-gray-700">
                <%= tag.titleize %>
              </span>
            <% end %>
          </div>
        <% end %>
      </header>

      <% if @post.featured_image %>
        <div class="mb-8 rounded-lg overflow-hidden shadow-lg">
          <%= image_tag @post.featured_image, alt: (@post.title || "Featured image"), class: "w-full h-auto object-cover" %>
        </div>
      <% end %>

      <div class="prose prose-lg max-w-none text-gray-800">
        <%# Dynamically render the content partial based on the slug %>
        <% content_partial_path = "blog/posts/#{params[:slug]}_content" %>
        <% if lookup_context.template_exists?(content_partial_path, [], true) %>
          <%= render partial: content_partial_path %>
        <% else %>
          <% if Rails.env.development? || Rails.env.test? %>
            <p class="text-red-500">
              Error: Content for this post could not be found. Expected partial:
              <%= content_partial_path %>
            </p>
            <p>
              Please ensure a file named an underscore followed by the slug and then
              <code>_content.html.erb</code> (e.g.,
              <code>_my-first-post_content.html.erb</code>) exists in
              <code>app/views/blog/posts/</code>.
            </p>
          <% else %>
            <p class="text-red-500">
              Sorry, this post is currently unavailable.
            </p>
          <% end %>
        <% end %>
      </div>

      <%# TODO: Add navigation to next/previous posts if desired %>
      <%# TODO: Add social sharing buttons %>
      <%# TODO: Add comments section if planned %>

      <div class="mt-12 pt-8 border-t border-gray-200">
        <%= link_to "← Back to Blog", blog_index_path, class: "text-pink-600 hover:text-pink-800 font-semibold" %>
      </div>
    </article>
  </div> <%# Closes .container %>
</div> <%# Closes .blog-scope %>

<%= render "home/shared/footer" %>
